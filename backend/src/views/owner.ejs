<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* NOTE: You should ensure 'Gemini_Generated_Image_wv0zo1wv0zo1wv0z.jpg' is the file name, not .png */
        .blurred-bg {
            /* Assuming the image file is named .jpg as in previous conversation */
            background-image: url(Gemini_Generated_Image_wv0zo1wv0zo1wv0z.png);
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            background-repeat: no-repeat;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8f9fa;
        }

        /* Subtle ring focus for interactive elements */
        .focus-ring {
            transition: box-shadow 0.2s, border-color 0.2s;
        }


        /* Custom style for the View button hover effect */
        .hover\:text-blue-600:hover {
            color: #2563eb;
        }

        /* --- Navigation Underline CSS --- */
        .header-content-wrapper {
            position: relative;
            padding-bottom: 5px;
        }

        #nav-underline {
            position: absolute;
            /* Crucial for positioning */
            height: 2px;
            left: 0;
            bottom: 0;
            background-color: rgb(39, 38, 38);
            /* Make the underline visible (Tailwind blue-500) */
            transition: all 0.3s ease-in-out;
            width: 0;
            /* Starts at 0 width */

        }

        /* End Navigation Underline CSS */
    </style>
</head>

<body class="blurred-bg min-h-screen font-sans text-gray-800">
    <header class="w-full p-8 flex justify-center z-50">
        <div class="w-full max-w-7xl flex justify-between items-center frosted-input p-4 rounded-full shadow-lg">

            <div class="flex items-center space-x-2">
                <span class="font-bold text-xl brand-logo text-gray-900">TouristSafe</span>
            </div>

            <div class="header-content-wrapper relative">

                <nav class="navigation-links hidden md:flex space-x-12 text-gray-300 font-medium z-10">
                    <a href="#all-users" class="nav-item active text-gray-800 transition duration-200"
                        data-page="all-users">All Users</a>
                    <a href="#alerts" class="nav-item text-gray-800 transition duration-200"
                        data-page="alerts">Alerts</a>
                    <a href="#emergency" class="nav-item text-gray-800 transition duration-200"
                        data-page="emergency">Emergency Alerts</a>
                    <a href="#dashboard" class="nav-item text-gray-800 transition duration-200"
                        data-page="dashboard">Dashboard</a>
                </nav>

                <div id="nav-underline"></div>
            </div>

            <button
                class=" text-gray-800 px-2 py-2 rounded-full flex items-center space-x-2 hover:bg-gray-800 hover:text-white transition duration-200">
                <span><svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="1.5"
                        viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round"
                        xmlns="http://www.w3.org/2000/svg">
                        <path d='M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0' />
                        <path d='M14.5 9.25a2.5 2.5 0 1 1-5 0 2.5 2.5 0 0 1 5 0M17 19.5c-.317-6.187-9.683-6.187-10 0' />
                    </svg></span>
            </button>
        </div>
    </header>

    <div class="max-w-6xl mx-auto p-6 lg:p-8">

        <div
            class="mb-6 flex flex-col md:flex-row justify-between items-start md:items-center space-y-4 md:space-y-0 md:space-x-4">

            <div class="relative flex-grow w-full md:w-auto">
                <input type="text" placeholder="Search by Name, ID, or Location..." id="search-tourists"
                    class="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg text-gray-700 focus-ring focus:border-blue-500 transition duration-150">
                <svg class="absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400" fill="none"
                    stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                </svg>
            </div>

            <div class="w-full md:w-48 bg-blue-50 rounded-xl p-4 shadow-md border border-blue-200">
                <p class="text-sm font-medium text-blue-600">Total Tourists</p>
                <p class="text-2xl font-bold text-blue-800 mt-1" id="tourist-count">4</p>
            </div>
        </div>

        <div class="space-y-4" id="tourist-list-container">

            <%Users.forEach((user)=>{%>
                <div
                    class="tourist-item bg-white rounded-xl shadow-md p-5 flex items-center justify-between border border-gray-200 hover:shadow-lg transition duration-200 focus-ring cursor-pointer">
                    <div class="flex items-center flex-grow">
                        <div
                            class="w-10 h-10 rounded-full bg-blue-500 flex items-center justify-center mr-4 flex-shrink-0">
                            <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"
                                xmlns="http://www.w3.org/2000/svg">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>

                        <div class="flex-grow">
                            <p class="font-bold text-lg text-gray-800">
                                <%=user._id%>
                            </p>
                            <p class="text-sm text-gray-500 mt-0.5">ID:12345 <span
                                    class="text-gray-600 font-mono">TS-ATX9NCP4P</span></p>
                            <p class="text-xs text-gray-400 mt-1">
                                <span class="font-medium text-gray-500">India</span>
                                <span class="mx-1 text-gray-300">â€¢</span>
                                <span class="text-gray-700">
                                    <%=user.startLocation%>, <%=user.endLocation%>
                                </span>
                            </p>
                        </div>
                    </div>

                    <div class="flex items-center space-x-4">
                        <span
                            class="px-4 py-1 text-xs font-bold rounded-full bg-green-500 text-white shadow-md shadow-green-500/30">Active</span>
                        <button onclick="showModal('<%=user._id%>')"
                            class="text-gray-500 hover:text-blue-600 transition duration-150 focus-ring p-2 rounded-full flex items-center space-x-1">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"
                                xmlns="http://www.w3.org/2000/svg">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
                            </svg>
                            <span>View</span>
                        </button>
                    </div>
                </div>


                <%})%>



                    <!-- HIDDEN POP-UP -->
                    <div id="tourist-profile-modal"
                        class="fixed inset-0 bg-gray-900 bg-opacity-75 hidden z-50 flex items-center justify-center transition-opacity duration-300"
                        aria-modal="true" role="dialog">

                        <div class="bg-white rounded-xl shadow-2xl w-full max-w-2xl p-6 lg:p-8 transform transition-all duration-300 scale-95"
                            onclick="event.stopPropagation()">

                            <div class="flex justify-between items-center pb-4 border-b border-gray-100 mb-4">
                                <h3 class="text-xl font-bold text-gray-800 flex items-center space-x-2">
                                    <svg class="w-6 h-6 text-gray-00" fill="none" stroke="currentColor"
                                        stroke-width="1.5" viewBox="0 0 24 24" stroke-linecap="round"
                                        stroke-linejoin="round" xmlns="http://www.w3.org/2000/svg">
                                        <path
                                            d='M15 7.5a3 3 0 1 1-6 0 3 3 0 0 1 6 0m4.5 13c-.475-9.333-14.525-9.333-15 0' />
                                        <path d='m10.258 18.992 1.034 1.181c.095.109.266.1.35-.016l2.1-2.907' />
                                    </svg>
                                    <span>Tourist Safety Profile</span>
                                </h3>
                                <button onclick="hideModal()"
                                    class="text-gray-400 hover:text-gray-700 transition duration-150 p-1 rounded-full">
                                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"
                                        xmlns="http://www.w3.org/2000/svg">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M6 18L18 6M6 6l12 12"></path>
                                    </svg>
                                </button>
                            </div>

                            <div class="grid grid-cols-2 gap-x-6 gap-y-4 text-sm">

                                <div class="flex items-center space-x-3">
                                    <svg class="w-5 h-5 text-blue-500" fill="none" stroke="currentColor"
                                        viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z">
                                        </path>
                                    </svg>
                                    <p><span class="font-medium text-gray-600">Name:</span> Jane Smith</p>
                                </div>
                                <div class="flex items-center space-x-3">
                                    <svg class="w-5 h-5 text-blue-500" fill="none" stroke="currentColor"
                                        stroke-width="1.5" viewBox="0 0 24 24" stroke-linecap="round"
                                        stroke-linejoin="round" xmlns="http://www.w3.org/2000/svg">
                                        <path
                                            d='M4 21v-5.313m0 0c5.818-4.55 10.182 4.55 16 0V4.313c-5.818 4.55-10.182-4.55-16 0z' />
                                    </svg>
                                    <p><span class="font-medium text-gray-600">Nationality:</span> Canadian</p>
                                </div>

                                <div class="flex items-center space-x-3">
                                    <svg class="w-5 h-5 text-blue-500" fill="none" stroke="currentColor"
                                        viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z">
                                        </path>
                                    </svg>
                                    <p><span class="font-medium text-gray-600">Contact:</span> +1 234 567 890</p>
                                </div>
                                <div class="flex items-center space-x-3">
                                    <svg class="w-5 h-5 text-blue-500" fill="none" stroke="currentColor"
                                        stroke-width="1.5" viewBox="0 0 24 24" stroke-linecap="round"
                                        stroke-linejoin="round" xmlns="http://www.w3.org/2000/svg">
                                        <path
                                            d='M15.6 14.522c-2.395 2.52-8.504-3.534-6.1-6.064 1.468-1.545-.19-3.31-1.108-4.609-1.723-2.435-5.504.927-5.39 3.066.363 6.746 7.66 14.74 14.726 14.042 2.21-.218 4.75-4.21 2.215-5.669-1.268-.73-3.009-2.17-4.343-.767M14 3a7 7 0 0 1 7 7m-7-3a3 3 0 0 1 3 3' />
                                    </svg>
                                    <p><span class="font-medium text-gray-600">Emergency Contact:</span> +1 111 222 333
                                    </p>
                                </div>

                                <div class="flex items-center space-x-3">
                                    <svg class="w-5 h-5 text-blue-500" fill="none" stroke="currentColor"
                                        viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8m-1.5 10a2 2 0 01-2 2H5.5a2 2 0 01-2-2V8.5a2 2 0 012-2h13a2 2 0 012 2V18z">
                                        </path>
                                    </svg>
                                    <p><span class="font-medium text-gray-600">Email:</span> jane@example.com</p>
                                </div>
                                <div class="flex items-center space-x-3">
                                    <svg class="w-5 h-5 text-blue-500" fill="none" stroke="currentColor"
                                        viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"></path>
                                    </svg>
                                    <p><span class="font-medium text-gray-600">ID Proof:</span> Passport #123456</p>
                                </div>

                                <div class="col-span-2 mt-4 p-4 bg-blue-50 border border-blue-200 rounded-lg">
                                    <h4 class="font-semibold text-blue-700 mb-2 flex items-center space-x-2">
                                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"
                                            xmlns="http://www.w3.org/2000/svg">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" />
                                        </svg>
                                        <span>Trip Route</span>
                                    </h4>
                                    <div class="flex items-center justify-between text-gray-800 text-sm">
                                        <div class="text-center">
                                            <p class="font-medium">Jaipur</p>
                                            <p class="text-xs text-gray-500">12 Sep 2025, 10:00 AM</p>
                                        </div>
                                        <div class="flex-grow mx-2 h-0.5 bg-blue-300"></div>
                                        <div class="text-center">
                                            <p class="font-medium">Delhi</p>
                                            <p class="text-xs text-gray-500">12 Sep 2025, 05:00 PM</p>
                                        </div>
                                    </div>
                                </div>



                            </div>

                        </div>
                    </div>

        </div>
    </div>


    <script>
        // Add these two functions to your existing <script> block

        /**
         * Shows the Tourist Profile Modal.
         */
        function showModal(id) {
            const modal = document.getElementById('tourist-profile-modal');
            // const journey = 

            if (modal) {
                modal.classList.remove('hidden');
                // Optional: Add a class to body to prevent background scrolling
                document.body.style.overflow = 'hidden';
            }
        }

        /**
         * Hides the Tourist Profile Modal.
         */
        function hideModal() {
            const modal = document.getElementById('tourist-profile-modal');
            if (modal) {
                modal.classList.add('hidden');
                // Optional: Restore background scrolling
                document.body.style.overflow = '';
            }
        }

        // Ensure you also hide the modal when clicking the dark background overlay
        document.getElementById('tourist-profile-modal').addEventListener('click', (e) => {
            // Only hide if the click is directly on the overlay, not the content box
            if (e.target.id === 'tourist-profile-modal') {
                hideModal();
            }
        });



        document.addEventListener('DOMContentLoaded', () => {
            // Both functions initialized here
            setupTouristSearch();
            initializeUnderline();
        });

        // --- Search and Count Functionality ---

        /**
         * Updates the tourist count display on the dashboard.
         * @param {number} count - The number of visible tourists.
         */
        function updateTouristCount(count) {
            const countElement = document.getElementById('tourist-count');
            if (countElement) {
                // Formats the number with a comma (e.g., 1,245)
                countElement.textContent = count.toLocaleString();
            }
        }

        /**
         * Sets up the functionality to filter the tourist list based on search input.
         */
        function setupTouristSearch() {
            const searchInput = document.getElementById('search-tourists');
            const touristItems = document.querySelectorAll('.tourist-item');

            // Initialize the count display with the total number of items
            updateTouristCount(touristItems.length);

            if (!searchInput || touristItems.length === 0) {
                return;
            }

            searchInput.addEventListener('keyup', () => {
                const searchTerm = searchInput.value.toLowerCase().trim();
                let visibleCount = 0;

                touristItems.forEach(item => {
                    // Get all text content for comprehensive searching
                    const itemText = item.textContent.toLowerCase();

                    // Check if the item's content includes the search term
                    if (itemText.includes(searchTerm)) {
                        // Ensure the item remains a flex container when visible
                        item.style.display = 'flex';
                        visibleCount++;
                    } else {
                        item.style.display = 'none'; // Hide the item
                    }
                });

                // Update the summary card with the new count
                updateTouristCount(visibleCount);
            });
        }

        // --- Navigation Underline Functionality ---

        function initializeUnderline() {
            const underline = document.getElementById('nav-underline');
            const navItems = document.querySelectorAll('.nav-item');

            if (!underline || navItems.length === 0) return;

            // Set the initial active link based on the 'active' class
            let activeLink = document.querySelector('.nav-item.active') || navItems[0];

            // Function to calculate and move the underline
            const moveUnderline = (targetElement) => {
                if (!targetElement) return;

                // Get the position of the target link relative to the main document
                const targetRect = targetElement.getBoundingClientRect();

                // Get the position of the underline's parent wrapper
                const wrapperRect = underline.parentNode.getBoundingClientRect();

                // Calculate position relative to the wrapper
                const leftPosition = targetRect.left - wrapperRect.left;
                const width = targetRect.width;

                // Apply styles to the underline div
                // underline.style.width = ${ width } px;
                // Use translate3d for better GPU performance and smoothness
                // underline.style.transform = translateX(${ leftPosition }px);
            };

            // 1. Initial placement on page load
            moveUnderline(activeLink);

            // 2. Listen for resize events to reposition the underline
            window.addEventListener('resize', () => moveUnderline(activeLink));

            // 3. Add interaction (Hover and Click)
            navItems.forEach(item => {
                // Set the active link on click
                item.addEventListener('click', (e) => {
                    navItems.forEach(link => link.classList.remove('active'));
                    e.currentTarget.classList.add('active');
                    activeLink = e.currentTarget;
                    // Move to the new active link and ensure the visual update
                    moveUnderline(activeLink);
                });

                // Move underline on hover (Follow the mouse)
                item.addEventListener('mouseenter', (e) => {
                    moveUnderline(e.currentTarget);
                });

                // Return underline to the active link on mouse leave
                item.addEventListener('mouseleave', () => {
                    moveUnderline(activeLink);
                });
            });
        }
    </script>
</body>

</html>